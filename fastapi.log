  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2110, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _connection_for_bind
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 974, in _raise_for_prerequisite_state
    "This Session's transaction has been rolled back "
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/exc.py", line 115, in __str__
    return self._sql_message()
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/exc.py", line 532, in _sql_message
    details.append("[parameters: %r]" % params_repr)
                   ~~~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 676, in __repr__
    return self._repr_params(
           ^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 731, in _repr_params
    return self._repr_param_dict(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 763, in _repr_param_dict
    ", ".join(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 764, in <genexpr>
    f"{key!r}: {trunc(value)}"
                ^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 562, in trunc
    rep = repr(value)
          ^^^^^^^^^^^
  File "/app/app/db/models/user.py", line 39, in __repr__
    return f"<User id={self.id}>"
                       ^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 566, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1116, in _fire_loader_callables
    return state._load_expired(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state.py", line 803, in _load_expired
    self.manager.expired_attribute_loader(self, toload, passive)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/loading.py", line 1670, in load_scalar_attributes
    result = load_on_ident(
             ^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/loading.py", line 509, in load_on_ident
    return load_on_pk_identity(
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/loading.py", line 694, in load_on_pk_identity
    session.execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2241, in _execute_internal
    conn = self._connection_for_bind(bind)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2110, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _connection_for_bind
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 974, in _raise_for_prerequisite_state
    "This Session's transaction has been rolled back "
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/exc.py", line 115, in __str__
    return self._sql_message()
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/exc.py", line 532, in _sql_message
    details.append("[parameters: %r]" % params_repr)
                   ~~~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 676, in __repr__
    return self._repr_params(
           ^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 731, in _repr_params
    return self._repr_param_dict(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 763, in _repr_param_dict
    ", ".join(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 764, in <genexpr>
    f"{key!r}: {trunc(value)}"
                ^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 562, in trunc
    rep = repr(value)
          ^^^^^^^^^^^
  File "/app/app/db/models/user.py", line 39, in __repr__
    return f"<User id={self.id}>"
                       ^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 566, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1116, in _fire_loader_callables
    return state._load_expired(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state.py", line 803, in _load_expired
    self.manager.expired_attribute_loader(self, toload, passive)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/loading.py", line 1670, in load_scalar_attributes
    result = load_on_ident(
             ^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/loading.py", line 509, in load_on_ident
    return load_on_pk_identity(
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/loading.py", line 694, in load_on_pk_identity
    session.execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2241, in _execute_internal
    conn = self._connection_for_bind(bind)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2110, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _connection_for_bind
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 974, in _raise_for_prerequisite_state
    "This Session's transaction has been rolled back "
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/exc.py", line 115, in __str__
    return self._sql_message()
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/exc.py", line 532, in _sql_message
    details.append("[parameters: %r]" % params_repr)
                   ~~~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 676, in __repr__
    return self._repr_params(
           ^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 731, in _repr_params
    return self._repr_param_dict(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 763, in _repr_param_dict
    ", ".join(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 764, in <genexpr>
    f"{key!r}: {trunc(value)}"
                ^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 562, in trunc
    rep = repr(value)
          ^^^^^^^^^^^
  File "/app/app/db/models/user.py", line 39, in __repr__
    return f"<User id={self.id}>"
                       ^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 566, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1116, in _fire_loader_callables
    return state._load_expired(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state.py", line 803, in _load_expired
    self.manager.expired_attribute_loader(self, toload, passive)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/loading.py", line 1670, in load_scalar_attributes
    result = load_on_ident(
             ^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/loading.py", line 509, in load_on_ident
    return load_on_pk_identity(
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/loading.py", line 694, in load_on_pk_identity
    session.execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2241, in _execute_internal
    conn = self._connection_for_bind(bind)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2110, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _connection_for_bind
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 974, in _raise_for_prerequisite_state
    "This Session's transaction has been rolled back "
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/exc.py", line 115, in __str__
    return self._sql_message()
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/exc.py", line 532, in _sql_message
    details.append("[parameters: %r]" % params_repr)
                   ~~~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 676, in __repr__
    return self._repr_params(
           ^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 731, in _repr_params
    return self._repr_param_dict(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 763, in _repr_param_dict
    ", ".join(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 764, in <genexpr>
    f"{key!r}: {trunc(value)}"
                ^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 562, in trunc
    rep = repr(value)
          ^^^^^^^^^^^
  File "/app/app/db/models/user.py", line 39, in __repr__
    return f"<User id={self.id}>"
                       ^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 566, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1116, in _fire_loader_callables
    return state._load_expired(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state.py", line 803, in _load_expired
    self.manager.expired_attribute_loader(self, toload, passive)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/loading.py", line 1670, in load_scalar_attributes
    result = load_on_ident(
             ^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/loading.py", line 509, in load_on_ident
    return load_on_pk_identity(
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/loading.py", line 694, in load_on_pk_identity
    session.execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2241, in _execute_internal
    conn = self._connection_for_bind(bind)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2110, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _connection_for_bind
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 974, in _raise_for_prerequisite_state
    "This Session's transaction has been rolled back "
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/exc.py", line 115, in __str__
    return self._sql_message()
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/exc.py", line 532, in _sql_message
    details.append("[parameters: %r]" % params_repr)
                   ~~~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 676, in __repr__
    return self._repr_params(
           ^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 731, in _repr_params
    return self._repr_param_dict(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 763, in _repr_param_dict
    ", ".join(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 764, in <genexpr>
    f"{key!r}: {trunc(value)}"
                ^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 562, in trunc
    rep = repr(value)
          ^^^^^^^^^^^
  File "/app/app/db/models/user.py", line 39, in __repr__
    return f"<User id={self.id}>"
                       ^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 566, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1116, in _fire_loader_callables
    return state._load_expired(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state.py", line 803, in _load_expired
    self.manager.expired_attribute_loader(self, toload, passive)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/loading.py", line 1670, in load_scalar_attributes
    result = load_on_ident(
             ^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/loading.py", line 509, in load_on_ident
    return load_on_pk_identity(
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/loading.py", line 694, in load_on_pk_identity
    session.execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2241, in _execute_internal
    conn = self._connection_for_bind(bind)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2110, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _connection_for_bind
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 974, in _raise_for_prerequisite_state
    "This Session's transaction has been rolled back "
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/exc.py", line 115, in __str__
    return self._sql_message()
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/exc.py", line 532, in _sql_message
    details.append("[parameters: %r]" % params_repr)
                   ~~~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 676, in __repr__
    return self._repr_params(
           ^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 731, in _repr_params
    return self._repr_param_dict(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 763, in _repr_param_dict
    ", ".join(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 764, in <genexpr>
    f"{key!r}: {trunc(value)}"
                ^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 562, in trunc
    rep = repr(value)
          ^^^^^^^^^^^
  File "/app/app/db/models/user.py", line 39, in __repr__
    return f"<User id={self.id}>"
                       ^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 566, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1116, in _fire_loader_callables
    return state._load_expired(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state.py", line 803, in _load_expired
    self.manager.expired_attribute_loader(self, toload, passive)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/loading.py", line 1670, in load_scalar_attributes
    result = load_on_ident(
             ^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/loading.py", line 509, in load_on_ident
    return load_on_pk_identity(
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/loading.py", line 694, in load_on_pk_identity
    session.execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2241, in _execute_internal
    conn = self._connection_for_bind(bind)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2110, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _connection_for_bind
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 974, in _raise_for_prerequisite_state
    "This Session's transaction has been rolled back "
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/exc.py", line 115, in __str__
    return self._sql_message()
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/exc.py", line 532, in _sql_message
    details.append("[parameters: %r]" % params_repr)
                   ~~~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 676, in __repr__
    return self._repr_params(
           ^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 731, in _repr_params
    return self._repr_param_dict(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 763, in _repr_param_dict
    ", ".join(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 764, in <genexpr>
    f"{key!r}: {trunc(value)}"
                ^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 562, in trunc
    rep = repr(value)
          ^^^^^^^^^^^
  File "/app/app/db/models/user.py", line 39, in __repr__
    return f"<User id={self.id}>"
                       ^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 566, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1116, in _fire_loader_callables
    return state._load_expired(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state.py", line 803, in _load_expired
    self.manager.expired_attribute_loader(self, toload, passive)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/loading.py", line 1670, in load_scalar_attributes
    result = load_on_ident(
             ^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/loading.py", line 509, in load_on_ident
    return load_on_pk_identity(
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/loading.py", line 694, in load_on_pk_identity
    session.execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2241, in _execute_internal
    conn = self._connection_for_bind(bind)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2110, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _connection_for_bind
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 974, in _raise_for_prerequisite_state
    "This Session's transaction has been rolled back "
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/exc.py", line 115, in __str__
    return self._sql_message()
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/exc.py", line 532, in _sql_message
    details.append("[parameters: %r]" % params_repr)
                   ~~~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 676, in __repr__
    return self._repr_params(
           ^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 731, in _repr_params
    return self._repr_param_dict(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 763, in _repr_param_dict
    ", ".join(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 764, in <genexpr>
    f"{key!r}: {trunc(value)}"
                ^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 562, in trunc
    rep = repr(value)
          ^^^^^^^^^^^
  File "/app/app/db/models/user.py", line 39, in __repr__
    return f"<User id={self.id}>"
                       ^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 566, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1116, in _fire_loader_callables
    return state._load_expired(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state.py", line 803, in _load_expired
    self.manager.expired_attribute_loader(self, toload, passive)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/loading.py", line 1670, in load_scalar_attributes
    result = load_on_ident(
             ^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/loading.py", line 509, in load_on_ident
    return load_on_pk_identity(
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/loading.py", line 694, in load_on_pk_identity
    session.execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2241, in _execute_internal
    conn = self._connection_for_bind(bind)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2110, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _connection_for_bind
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 974, in _raise_for_prerequisite_state
    "This Session's transaction has been rolled back "
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/exc.py", line 115, in __str__
    return self._sql_message()
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/exc.py", line 532, in _sql_message
    details.append("[parameters: %r]" % params_repr)
                   ~~~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 676, in __repr__
    return self._repr_params(
           ^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 731, in _repr_params
    return self._repr_param_dict(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 763, in _repr_param_dict
    ", ".join(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 764, in <genexpr>
    f"{key!r}: {trunc(value)}"
                ^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 562, in trunc
    rep = repr(value)
          ^^^^^^^^^^^
  File "/app/app/db/models/user.py", line 39, in __repr__
    return f"<User id={self.id}>"
                       ^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 566, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1116, in _fire_loader_callables
    return state._load_expired(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state.py", line 803, in _load_expired
    self.manager.expired_attribute_loader(self, toload, passive)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/loading.py", line 1670, in load_scalar_attributes
    result = load_on_ident(
             ^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/loading.py", line 509, in load_on_ident
    return load_on_pk_identity(
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/loading.py", line 694, in load_on_pk_identity
    session.execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2241, in _execute_internal
    conn = self._connection_for_bind(bind)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2110, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _connection_for_bind
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 974, in _raise_for_prerequisite_state
    "This Session's transaction has been rolled back "
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/exc.py", line 115, in __str__
    return self._sql_message()
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/exc.py", line 532, in _sql_message
    details.append("[parameters: %r]" % params_repr)
                   ~~~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 676, in __repr__
    return self._repr_params(
           ^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 731, in _repr_params
    return self._repr_param_dict(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 763, in _repr_param_dict
    ", ".join(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 764, in <genexpr>
    f"{key!r}: {trunc(value)}"
                ^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 562, in trunc
    rep = repr(value)
          ^^^^^^^^^^^
  File "/app/app/db/models/user.py", line 39, in __repr__
    return f"<User id={self.id}>"
                       ^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 566, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1116, in _fire_loader_callables
    return state._load_expired(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state.py", line 803, in _load_expired
    self.manager.expired_attribute_loader(self, toload, passive)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/loading.py", line 1670, in load_scalar_attributes
    result = load_on_ident(
             ^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/loading.py", line 509, in load_on_ident
    return load_on_pk_identity(
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/loading.py", line 694, in load_on_pk_identity
    session.execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2241, in _execute_internal
    conn = self._connection_for_bind(bind)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2110, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _connection_for_bind
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 974, in _raise_for_prerequisite_state
    "This Session's transaction has been rolled back "
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/exc.py", line 115, in __str__
    return self._sql_message()
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/exc.py", line 532, in _sql_message
    details.append("[parameters: %r]" % params_repr)
                   ~~~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 676, in __repr__
    return self._repr_params(
           ^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 731, in _repr_params
    return self._repr_param_dict(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 763, in _repr_param_dict
    ", ".join(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 764, in <genexpr>
    f"{key!r}: {trunc(value)}"
                ^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 562, in trunc
    rep = repr(value)
          ^^^^^^^^^^^
  File "/app/app/db/models/user.py", line 39, in __repr__
    return f"<User id={self.id}>"
                       ^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 566, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1116, in _fire_loader_callables
    return state._load_expired(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state.py", line 803, in _load_expired
    self.manager.expired_attribute_loader(self, toload, passive)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/loading.py", line 1670, in load_scalar_attributes
    result = load_on_ident(
             ^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/loading.py", line 509, in load_on_ident
    return load_on_pk_identity(
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/loading.py", line 694, in load_on_pk_identity
    session.execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2241, in _execute_internal
    conn = self._connection_for_bind(bind)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2110, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _connection_for_bind
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 974, in _raise_for_prerequisite_state
    "This Session's transaction has been rolled back "
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/exc.py", line 115, in __str__
    return self._sql_message()
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/exc.py", line 532, in _sql_message
    details.append("[parameters: %r]" % params_repr)
                   ~~~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 676, in __repr__
    return self._repr_params(
           ^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 731, in _repr_params
    return self._repr_param_dict(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 763, in _repr_param_dict
    ", ".join(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 764, in <genexpr>
    f"{key!r}: {trunc(value)}"
                ^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/util.py", line 562, in trunc
    rep = repr(value)
          ^^^^^^^^^^^
  File "/app/app/db/models/user.py", line 39, in __repr__
    return f"<User id={self.id}>"
                       ^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 566, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1116, in _fire_loader_callables
    return state._load_expired(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state.py", line 803, in _load_expired
    self.manager.expired_attribute_loader(self, toload, passive)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/loading.py", line 1672, in load_scalar_attributes
    select(mapper).set_label_style(LABEL_STYLE_TABLENAME_PLUS_COL),
    ^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/_selectable_constructors.py", line 537, in select
    return Select(*entities)
           ^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/selectable.py", line 5340, in __init__
    self._raw_columns = [
                        ^
RecursionError: maximum recursion depth exceeded
WARNING:  WatchFiles detected changes in 'app/db/models/user.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [11]
/usr/local/lib/python3.11/site-packages/pydantic/_internal/_config.py:373: UserWarning: Valid config keys have changed in V2:
* 'orm_mode' has been renamed to 'from_attributes'
  warnings.warn(message, UserWarning)
INFO:app.main:ローカル環境で動作中、デバッグログを有効にします
INFO:app.main:ローカル環境でCORS設定: ['https://cas.tokyo', 'https://cas.tokyo', 'http://localhost:3000', 'http://localhost:3001']
INFO:app.main:Application startup complete. Running in local environment.
INFO:     Started server process [367]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
Models initialized
💡 `.env` が見つかりません。環境変数から直接読み込みます。

===== ローカル環境で実行中 =====

DEBUG: REDIRECT_URI (os.getenv) = https://api.cas.tokyo/api/v1/account/line/callback
DEBUG: REDIRECT_URI (os.environ) = https://api.cas.tokyo/api/v1/account/line/callback

===== 必要な環境変数の値を確認 =====

✅ LINE_CHANNEL_ACCESS_TOKEN: 9Uvkw******************************************************************************************************************************************************************ilFU= (長さ: 172文字)
✅ LINE_CHANNEL_SECRET: bcb66**********************d6d02 (長さ: 32文字)
✅ OPENAI_API_KEY: sk-pr**********************************************************************************************************************************************************pR7YA (長さ: 164文字)
✅ DATABASE_URL: mysql+pymysql://taichiumeki:Seven8tar8@myproject-staging-db.cf0ewwguuw7i.ap-northeast-1.rds.amazonaws.com/staging_db
✅ REDIRECT_URI: https://api.cas.tokyo/api/v1/account/line/callback
DEBUG: TEST_VARIABLE = None
WARNING:  WatchFiles detected changes in 'app/features/posts/repositories/post_repository.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [367]
/usr/local/lib/python3.11/site-packages/pydantic/_internal/_config.py:373: UserWarning: Valid config keys have changed in V2:
* 'orm_mode' has been renamed to 'from_attributes'
  warnings.warn(message, UserWarning)
INFO:app.main:ローカル環境で動作中、デバッグログを有効にします
INFO:app.main:ローカル環境でCORS設定: ['https://cas.tokyo', 'https://cas.tokyo', 'http://localhost:3000', 'http://localhost:3001']
INFO:app.main:Application startup complete. Running in local environment.
INFO:     Started server process [560]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
Models initialized
💡 `.env` が見つかりません。環境変数から直接読み込みます。

===== ローカル環境で実行中 =====

DEBUG: REDIRECT_URI (os.getenv) = https://api.cas.tokyo/api/v1/account/line/callback
DEBUG: REDIRECT_URI (os.environ) = https://api.cas.tokyo/api/v1/account/line/callback

===== 必要な環境変数の値を確認 =====

✅ LINE_CHANNEL_ACCESS_TOKEN: 9Uvkw******************************************************************************************************************************************************************ilFU= (長さ: 172文字)
✅ LINE_CHANNEL_SECRET: bcb66**********************d6d02 (長さ: 32文字)
✅ OPENAI_API_KEY: sk-pr**********************************************************************************************************************************************************pR7YA (長さ: 164文字)
✅ DATABASE_URL: mysql+pymysql://taichiumeki:Seven8tar8@myproject-staging-db.cf0ewwguuw7i.ap-northeast-1.rds.amazonaws.com/staging_db
✅ REDIRECT_URI: https://api.cas.tokyo/api/v1/account/line/callback
DEBUG: TEST_VARIABLE = None
INFO:     172.18.0.1:58212 - "GET /api/v1/setup/status/setup_status/406 HTTP/1.1" 200 OK
INFO:     172.18.0.1:58218 - "OPTIONS /api/v1/account/auth/extend_refresh_token HTTP/1.1" 200 OK
🚀 【extend_refresh_token】 リクエストを今から受信
🚀 【extend_refresh_token】 リクエスト受信 - refresh_token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI0MDYiLCJ1c2VyX2lkIjo0MDYsImV4cCI6MTc1OTgxMjE5MCwiaWF0IjoxNzUyMDM2MTkwfQ.t3KVpfvFF294D_ybIVHslAyxiXd3I2t_B9TM5a5GaUg
🕒 【extend_refresh_token】 現在時刻: 1752038481 / refresh_token 有効期限: 1759812190 / 残り 7773709 秒
🔄 【extend_refresh_token】 `refresh_token` の期限が近いため更新: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI0MDYiLCJ1c2VyX2lkIjo0MDYsImV4cCI6MTc1OTgxNDQ4MSwiaWF0IjoxNzUyMDM4NDgxfQ.mEhycQAhR57F5F9-fa_lJpHLTZgF0C2pky8Ph788eOc
INFO:     172.18.0.1:58226 - "POST /api/v1/account/auth/extend_refresh_token HTTP/1.1" 200 OK
INFO:     172.18.0.1:58218 - "OPTIONS /api/v1/account/auth/refresh HTTP/1.1" 200 OK
INFO:app.features.account.endpoints.auth_jwt:🚀 [refresh] トークン更新リクエスト受信
INFO:app.features.account.endpoints.auth_jwt:🔍 受信した refresh_token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI0MDYiLCJ1c2VyX2lkIjo0MDYsImV4cCI6MTc1OTgxNDQ4MSwiaWF0IjoxNzUyMDM4NDgxfQ.mEhycQAhR57F5F9-fa_lJpHLTZgF0C2pky8Ph788eOc
INFO:app.features.account.endpoints.auth_jwt:🔹 DBから取得した `user_type`: cast, `affi_type`: None
INFO:app.features.account.endpoints.auth_jwt:✅ 新しい認証トークンを発行: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI0MDYiLCJ1c2VyX2lkIjo0MDYsInVzZXJfdHlwZSI6ImNhc3QiLCJhZmZpX3R5cGUiOm51bGwsImV4cCI6MTc1MjA0NTY4MSwiaWF0IjoxNzUyMDM4NDgxfQ.CxfSxIUUxB035mfyj0u4P43yRm-g-q-zJH6NHb7MNpQ
INFO:     172.18.0.1:58226 - "POST /api/v1/account/auth/refresh HTTP/1.1" 200 OK
INFO:     172.18.0.1:58218 - "OPTIONS /api/v1/cast/identity-verification/status HTTP/1.1" 200 OK
INFO:     172.18.0.1:58234 - "OPTIONS /api/v1/posts/cast HTTP/1.1" 200 OK
INFO:     172.18.0.1:58242 - "OPTIONS /api/v1/cast/identity-verification/status HTTP/1.1" 200 OK
[DEBUG] Received cast_id: 406, type: <class 'int'>
[DEBUG] Using cast_id: 406
[ROUTER DEBUG] Returning result: {'cast_id': 406, 'status': 'pending', 'submitted_at': datetime.datetime(2025, 6, 14, 14, 30, 7), 'reviewed_at': None, 'rejection_reason': None, 'bank_name': None, 'branch_name': None, 'branch_code': None, 'account_type': None, 'account_number': None, 'account_holder': None, 'message': '本人確認申請を作成しました。後日結果を確認してください。'}
INFO:     172.18.0.1:58226 - "GET /api/v1/cast/identity-verification/status HTTP/1.1" 200 OK
[DEBUG] Received cast_id: 406, type: <class 'int'>
[DEBUG] Using cast_id: 406
[ROUTER DEBUG] Returning result: {'cast_id': 406, 'status': 'pending', 'submitted_at': datetime.datetime(2025, 6, 14, 14, 30, 7), 'reviewed_at': None, 'rejection_reason': None, 'bank_name': None, 'branch_name': None, 'branch_code': None, 'account_type': None, 'account_number': None, 'account_holder': None, 'message': '本人確認申請を作成しました。後日結果を確認してください。'}
INFO:     172.18.0.1:58264 - "GET /api/v1/cast/identity-verification/status HTTP/1.1" 200 OK
INFO:     172.18.0.1:58250 - "POST /api/v1/posts/cast HTTP/1.1" 200 OK
INFO:     172.18.0.1:62776 - "OPTIONS /api/v1/media/upload/generate-url HTTP/1.1" 200 OK
[INFO] 🔐 ユーザー認証成功: user_id=<User id=406>
[DEBUG] 生成された presigned_url: https://cast-media.s3.amazonaws.com/0/blog/0/6Jor2ZGQ_400x400-2.jpg?AWSAccessKeyId=AKIA3UR5VTV4FQZDMDYD&Signature=8EuLnMf6tehxnIA3cpWdROpHeBE%3D&content-type=image%2Fjpeg&Expires=1752042091
INFO:     172.18.0.1:62776 - "POST /api/v1/media/upload/generate-url HTTP/1.1" 200 OK
INFO:     172.18.0.1:62776 - "OPTIONS /api/v1/media/upload/register HTTP/1.1" 200 OK
[INFO] ✅ 新しいメディア登録成功: https://cast-media.s3.amazonaws.com/0/blog/0/6Jor2ZGQ_400x400-2.jpg, ID: 386
INFO:     172.18.0.1:62776 - "POST /api/v1/media/upload/register HTTP/1.1" 200 OK
INFO:     172.18.0.1:62776 - "OPTIONS /api/v1/posts/create HTTP/1.1" 200 OK
[ERROR] 投稿作成エラー: SQL expression element or literal value expected, got <User id=406>.
INFO:     172.18.0.1:62778 - "POST /api/v1/posts/create HTTP/1.1" 500 Internal Server Error
INFO:     172.18.0.1:62776 - "OPTIONS /api/v1/media/upload/update-target HTTP/1.1" 200 OK
INFO:     172.18.0.1:62776 - "POST /api/v1/media/upload/update-target HTTP/1.1" 422 Unprocessable Entity
INFO:     172.18.0.1:62778 - "POST /api/v1/posts/cast HTTP/1.1" 200 OK
WARNING:  WatchFiles detected changes in 'app/features/posts/endpoints/post_endpoints.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [560]
/usr/local/lib/python3.11/site-packages/pydantic/_internal/_config.py:373: UserWarning: Valid config keys have changed in V2:
* 'orm_mode' has been renamed to 'from_attributes'
  warnings.warn(message, UserWarning)
INFO:app.main:ローカル環境で動作中、デバッグログを有効にします
INFO:app.main:ローカル環境でCORS設定: ['https://cas.tokyo', 'https://cas.tokyo', 'http://localhost:3000', 'http://localhost:3001']
INFO:app.main:Application startup complete. Running in local environment.
INFO:     Started server process [724]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
Models initialized
💡 `.env` が見つかりません。環境変数から直接読み込みます。

===== ローカル環境で実行中 =====

DEBUG: REDIRECT_URI (os.getenv) = https://api.cas.tokyo/api/v1/account/line/callback
DEBUG: REDIRECT_URI (os.environ) = https://api.cas.tokyo/api/v1/account/line/callback

===== 必要な環境変数の値を確認 =====

✅ LINE_CHANNEL_ACCESS_TOKEN: 9Uvkw******************************************************************************************************************************************************************ilFU= (長さ: 172文字)
✅ LINE_CHANNEL_SECRET: bcb66**********************d6d02 (長さ: 32文字)
✅ OPENAI_API_KEY: sk-pr**********************************************************************************************************************************************************pR7YA (長さ: 164文字)
✅ DATABASE_URL: mysql+pymysql://taichiumeki:Seven8tar8@myproject-staging-db.cf0ewwguuw7i.ap-northeast-1.rds.amazonaws.com/staging_db
✅ REDIRECT_URI: https://api.cas.tokyo/api/v1/account/line/callback
DEBUG: TEST_VARIABLE = None
INFO:     172.18.0.1:57806 - "GET /api/v1/setup/status/setup_status/406 HTTP/1.1" 200 OK
🚀 【extend_refresh_token】 リクエストを今から受信
🚀 【extend_refresh_token】 リクエスト受信 - refresh_token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI0MDYiLCJ1c2VyX2lkIjo0MDYsImV4cCI6MTc1OTgxNDQ4MSwiaWF0IjoxNzUyMDM4NDgxfQ.mEhycQAhR57F5F9-fa_lJpHLTZgF0C2pky8Ph788eOc
🕒 【extend_refresh_token】 現在時刻: 1752039034 / refresh_token 有効期限: 1759814481 / 残り 7775447 秒
🔄 【extend_refresh_token】 `refresh_token` の期限が近いため更新: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI0MDYiLCJ1c2VyX2lkIjo0MDYsImV4cCI6MTc1OTgxNTAzNCwiaWF0IjoxNzUyMDM5MDM0fQ.EFGPAVoLPaFWsUQzUXicUtzGXn-ZSQyEVBlcEyZEi2w
INFO:     172.18.0.1:55824 - "POST /api/v1/account/auth/extend_refresh_token HTTP/1.1" 200 OK
INFO:app.features.account.endpoints.auth_jwt:🚀 [refresh] トークン更新リクエスト受信
INFO:app.features.account.endpoints.auth_jwt:🔍 受信した refresh_token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI0MDYiLCJ1c2VyX2lkIjo0MDYsImV4cCI6MTc1OTgxNTAzNCwiaWF0IjoxNzUyMDM5MDM0fQ.EFGPAVoLPaFWsUQzUXicUtzGXn-ZSQyEVBlcEyZEi2w
INFO:app.features.account.endpoints.auth_jwt:🔹 DBから取得した `user_type`: cast, `affi_type`: None
INFO:app.features.account.endpoints.auth_jwt:✅ 新しい認証トークンを発行: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI0MDYiLCJ1c2VyX2lkIjo0MDYsInVzZXJfdHlwZSI6ImNhc3QiLCJhZmZpX3R5cGUiOm51bGwsImV4cCI6MTc1MjA0NjIzNCwiaWF0IjoxNzUyMDM5MDM0fQ.We7dKEWZ3Pz1XcPhLm2a6t3gRAwcE92i-OXZ-DEUNQ0
INFO:     172.18.0.1:55824 - "POST /api/v1/account/auth/refresh HTTP/1.1" 200 OK
[DEBUG] Received cast_id: 406, type: <class 'int'>
[DEBUG] Using cast_id: 406
[ROUTER DEBUG] Returning result: {'cast_id': 406, 'status': 'pending', 'submitted_at': datetime.datetime(2025, 6, 14, 14, 30, 7), 'reviewed_at': None, 'rejection_reason': None, 'bank_name': None, 'branch_name': None, 'branch_code': None, 'account_type': None, 'account_number': None, 'account_holder': None, 'message': '本人確認申請を作成しました。後日結果を確認してください。'}
INFO:     172.18.0.1:55824 - "GET /api/v1/cast/identity-verification/status HTTP/1.1" 200 OK
[DEBUG] Received cast_id: 406, type: <class 'int'>
[DEBUG] Using cast_id: 406
[ROUTER DEBUG] Returning result: {'cast_id': 406, 'status': 'pending', 'submitted_at': datetime.datetime(2025, 6, 14, 14, 30, 7), 'reviewed_at': None, 'rejection_reason': None, 'bank_name': None, 'branch_name': None, 'branch_code': None, 'account_type': None, 'account_number': None, 'account_holder': None, 'message': '本人確認申請を作成しました。後日結果を確認してください。'}
INFO:     172.18.0.1:55844 - "GET /api/v1/cast/identity-verification/status HTTP/1.1" 200 OK
INFO:     172.18.0.1:55840 - "POST /api/v1/posts/cast HTTP/1.1" 200 OK
[INFO] 🔐 ユーザー認証成功: user_id=<User id=406>
[DEBUG] 生成された presigned_url: https://cast-media.s3.amazonaws.com/0/blog/0/6Jor2ZGQ_400x400-2.jpg?AWSAccessKeyId=AKIA3UR5VTV4FQZDMDYD&Signature=QbiasC069uxV8QqTZ%2B2zOywlwoA%3D&content-type=image%2Fjpeg&Expires=1752042644
INFO:     172.18.0.1:56530 - "POST /api/v1/media/upload/generate-url HTTP/1.1" 200 OK
[INFO] ✅ 新しいメディア登録成功: https://cast-media.s3.amazonaws.com/0/blog/0/6Jor2ZGQ_400x400-2.jpg, ID: 387
INFO:     172.18.0.1:56530 - "POST /api/v1/media/upload/register HTTP/1.1" 200 OK
INFO:     172.18.0.1:56536 - "POST /api/v1/posts/create HTTP/1.1" 200 OK
[INFO] ✅ メディア(ID: 387)のターゲット情報を更新: blog/61
INFO:     172.18.0.1:56530 - "POST /api/v1/media/upload/update-target HTTP/1.1" 200 OK
INFO:     172.18.0.1:56536 - "POST /api/v1/posts/cast HTTP/1.1" 200 OK
[INFO] 🔐 ユーザー認証成功: user_id=<User id=406>
[DEBUG] 生成された presigned_url: https://cast-media.s3.amazonaws.com/0/blog/0/S__2171024.jpg?AWSAccessKeyId=AKIA3UR5VTV4FQZDMDYD&Signature=OhnoBtX3gKzPMB5gMBn1WzNpo0s%3D&content-type=image%2Fjpeg&Expires=1752042666
INFO:     172.18.0.1:57946 - "POST /api/v1/media/upload/generate-url HTTP/1.1" 200 OK
[INFO] ✅ 新しいメディア登録成功: https://cast-media.s3.amazonaws.com/0/blog/0/S__2171024.jpg, ID: 388
INFO:     172.18.0.1:57946 - "POST /api/v1/media/upload/register HTTP/1.1" 200 OK
INFO:     172.18.0.1:57956 - "POST /api/v1/posts/create HTTP/1.1" 200 OK
[INFO] ✅ メディア(ID: 388)のターゲット情報を更新: blog/62
INFO:     172.18.0.1:57984 - "POST /api/v1/media/upload/update-target HTTP/1.1" 200 OK
INFO:     172.18.0.1:57956 - "POST /api/v1/posts/cast HTTP/1.1" 200 OK
INFO:     172.18.0.1:64864 - "GET /api/v1/setup/status/setup_status/406 HTTP/1.1" 200 OK
INFO:     172.18.0.1:61592 - "OPTIONS /api/v1/media/upload/generate-url HTTP/1.1" 200 OK
[INFO] 🔐 ユーザー認証成功: user_id=<User id=406>
[DEBUG] 生成された presigned_url: https://cast-media.s3.amazonaws.com/0/blog/0/78c5265e-c6d0-437e-bb5b-37c121dd9605.jpg?AWSAccessKeyId=AKIA3UR5VTV4FQZDMDYD&Signature=egpuzF1BRyBs%2BgGMlqEHX5%2B7Mdw%3D&content-type=image%2Fjpeg&Expires=1752042702
INFO:     172.18.0.1:61592 - "POST /api/v1/media/upload/generate-url HTTP/1.1" 200 OK
INFO:     172.18.0.1:61592 - "OPTIONS /api/v1/media/upload/register HTTP/1.1" 200 OK
[INFO] ✅ 新しいメディア登録成功: https://cast-media.s3.amazonaws.com/0/blog/0/78c5265e-c6d0-437e-bb5b-37c121dd9605.jpg, ID: 389
INFO:     172.18.0.1:61592 - "POST /api/v1/media/upload/register HTTP/1.1" 200 OK
INFO:     172.18.0.1:62702 - "OPTIONS /api/v1/posts/create HTTP/1.1" 200 OK
INFO:     172.18.0.1:62718 - "POST /api/v1/posts/create HTTP/1.1" 200 OK
INFO:     172.18.0.1:62702 - "OPTIONS /api/v1/media/upload/update-target HTTP/1.1" 200 OK
[INFO] ✅ メディア(ID: 389)のターゲット情報を更新: blog/63
INFO:     172.18.0.1:62702 - "POST /api/v1/media/upload/update-target HTTP/1.1" 200 OK
INFO:     172.18.0.1:62702 - "OPTIONS /api/v1/posts/cast HTTP/1.1" 200 OK
INFO:     172.18.0.1:62718 - "POST /api/v1/posts/cast HTTP/1.1" 200 OK
[INFO] 🔐 ユーザー認証成功: user_id=<User id=406>
[DEBUG] 生成された presigned_url: https://cast-media.s3.amazonaws.com/0/blog/0/download-2.png?AWSAccessKeyId=AKIA3UR5VTV4FQZDMDYD&Signature=5C%2F6kWNlN7vpfOSCDpzu5T2nL5Y%3D&content-type=image%2Fpng&Expires=1752042733
INFO:     172.18.0.1:63782 - "POST /api/v1/media/upload/generate-url HTTP/1.1" 200 OK
[INFO] ✅ 新しいメディア登録成功: https://cast-media.s3.amazonaws.com/0/blog/0/download-2.png, ID: 390
INFO:     172.18.0.1:63824 - "POST /api/v1/media/upload/register HTTP/1.1" 200 OK
INFO:     172.18.0.1:63828 - "POST /api/v1/posts/create HTTP/1.1" 200 OK
[INFO] ✅ メディア(ID: 390)のターゲット情報を更新: blog/64
INFO:     172.18.0.1:63824 - "POST /api/v1/media/upload/update-target HTTP/1.1" 200 OK
INFO:     172.18.0.1:63828 - "POST /api/v1/posts/cast HTTP/1.1" 200 OK
WARNING:  WatchFiles detected changes in 'app/features/posts/repositories/post_repository.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [724]
/usr/local/lib/python3.11/site-packages/pydantic/_internal/_config.py:373: UserWarning: Valid config keys have changed in V2:
* 'orm_mode' has been renamed to 'from_attributes'
  warnings.warn(message, UserWarning)
INFO:app.main:ローカル環境で動作中、デバッグログを有効にします
INFO:app.main:ローカル環境でCORS設定: ['https://cas.tokyo', 'https://cas.tokyo', 'http://localhost:3000', 'http://localhost:3001']
INFO:app.main:Application startup complete. Running in local environment.
INFO:     Started server process [823]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
Models initialized
💡 `.env` が見つかりません。環境変数から直接読み込みます。

===== ローカル環境で実行中 =====

DEBUG: REDIRECT_URI (os.getenv) = https://api.cas.tokyo/api/v1/account/line/callback
DEBUG: REDIRECT_URI (os.environ) = https://api.cas.tokyo/api/v1/account/line/callback

===== 必要な環境変数の値を確認 =====

✅ LINE_CHANNEL_ACCESS_TOKEN: 9Uvkw******************************************************************************************************************************************************************ilFU= (長さ: 172文字)
✅ LINE_CHANNEL_SECRET: bcb66**********************d6d02 (長さ: 32文字)
✅ OPENAI_API_KEY: sk-pr**********************************************************************************************************************************************************pR7YA (長さ: 164文字)
✅ DATABASE_URL: mysql+pymysql://taichiumeki:Seven8tar8@myproject-staging-db.cf0ewwguuw7i.ap-northeast-1.rds.amazonaws.com/staging_db
✅ REDIRECT_URI: https://api.cas.tokyo/api/v1/account/line/callback
DEBUG: TEST_VARIABLE = None
WARNING:  WatchFiles detected changes in 'app/features/posts/services/post_service.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [823]
/usr/local/lib/python3.11/site-packages/pydantic/_internal/_config.py:373: UserWarning: Valid config keys have changed in V2:
* 'orm_mode' has been renamed to 'from_attributes'
  warnings.warn(message, UserWarning)
INFO:app.main:ローカル環境で動作中、デバッグログを有効にします
INFO:app.main:ローカル環境でCORS設定: ['https://cas.tokyo', 'https://cas.tokyo', 'http://localhost:3000', 'http://localhost:3001']
INFO:app.main:Application startup complete. Running in local environment.
INFO:     Started server process [912]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
Models initialized
💡 `.env` が見つかりません。環境変数から直接読み込みます。

===== ローカル環境で実行中 =====

DEBUG: REDIRECT_URI (os.getenv) = https://api.cas.tokyo/api/v1/account/line/callback
DEBUG: REDIRECT_URI (os.environ) = https://api.cas.tokyo/api/v1/account/line/callback

===== 必要な環境変数の値を確認 =====

✅ LINE_CHANNEL_ACCESS_TOKEN: 9Uvkw******************************************************************************************************************************************************************ilFU= (長さ: 172文字)
✅ LINE_CHANNEL_SECRET: bcb66**********************d6d02 (長さ: 32文字)
✅ OPENAI_API_KEY: sk-pr**********************************************************************************************************************************************************pR7YA (長さ: 164文字)
✅ DATABASE_URL: mysql+pymysql://taichiumeki:Seven8tar8@myproject-staging-db.cf0ewwguuw7i.ap-northeast-1.rds.amazonaws.com/staging_db
✅ REDIRECT_URI: https://api.cas.tokyo/api/v1/account/line/callback
DEBUG: TEST_VARIABLE = None
WARNING:  WatchFiles detected changes in 'app/features/posts/endpoints/post_endpoints.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [912]
/usr/local/lib/python3.11/site-packages/pydantic/_internal/_config.py:373: UserWarning: Valid config keys have changed in V2:
* 'orm_mode' has been renamed to 'from_attributes'
  warnings.warn(message, UserWarning)
INFO:app.main:ローカル環境で動作中、デバッグログを有効にします
INFO:app.main:ローカル環境でCORS設定: ['https://cas.tokyo', 'https://cas.tokyo', 'http://localhost:3000', 'http://localhost:3001']
INFO:app.main:Application startup complete. Running in local environment.
INFO:     Started server process [1014]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
Models initialized
💡 `.env` が見つかりません。環境変数から直接読み込みます。

===== ローカル環境で実行中 =====

DEBUG: REDIRECT_URI (os.getenv) = https://api.cas.tokyo/api/v1/account/line/callback
DEBUG: REDIRECT_URI (os.environ) = https://api.cas.tokyo/api/v1/account/line/callback

===== 必要な環境変数の値を確認 =====

✅ LINE_CHANNEL_ACCESS_TOKEN: 9Uvkw******************************************************************************************************************************************************************ilFU= (長さ: 172文字)
✅ LINE_CHANNEL_SECRET: bcb66**********************d6d02 (長さ: 32文字)
✅ OPENAI_API_KEY: sk-pr**********************************************************************************************************************************************************pR7YA (長さ: 164文字)
✅ DATABASE_URL: mysql+pymysql://taichiumeki:Seven8tar8@myproject-staging-db.cf0ewwguuw7i.ap-northeast-1.rds.amazonaws.com/staging_db
✅ REDIRECT_URI: https://api.cas.tokyo/api/v1/account/line/callback
DEBUG: TEST_VARIABLE = None
INFO:     172.18.0.1:65392 - "GET /api/v1/setup/status/setup_status/406 HTTP/1.1" 200 OK
INFO:     172.18.0.1:57094 - "OPTIONS /api/v1/account/auth/extend_refresh_token HTTP/1.1" 200 OK
🚀 【extend_refresh_token】 リクエストを今から受信
🚀 【extend_refresh_token】 リクエスト受信 - refresh_token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI0MDYiLCJ1c2VyX2lkIjo0MDYsImV4cCI6MTc1OTgxNTAzNCwiaWF0IjoxNzUyMDM5MDM0fQ.EFGPAVoLPaFWsUQzUXicUtzGXn-ZSQyEVBlcEyZEi2w
🕒 【extend_refresh_token】 現在時刻: 1752040496 / refresh_token 有効期限: 1759815034 / 残り 7774538 秒
🔄 【extend_refresh_token】 `refresh_token` の期限が近いため更新: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI0MDYiLCJ1c2VyX2lkIjo0MDYsImV4cCI6MTc1OTgxNjQ5NiwiaWF0IjoxNzUyMDQwNDk2fQ.weRAX0w4MVH9iZE7SIzjtq_BcM7iDjtYcsX2_pwA_Sw
INFO:     172.18.0.1:57106 - "POST /api/v1/account/auth/extend_refresh_token HTTP/1.1" 200 OK
INFO:     172.18.0.1:57094 - "OPTIONS /api/v1/account/auth/refresh HTTP/1.1" 200 OK
INFO:app.features.account.endpoints.auth_jwt:🚀 [refresh] トークン更新リクエスト受信
INFO:app.features.account.endpoints.auth_jwt:🔍 受信した refresh_token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI0MDYiLCJ1c2VyX2lkIjo0MDYsImV4cCI6MTc1OTgxNjQ5NiwiaWF0IjoxNzUyMDQwNDk2fQ.weRAX0w4MVH9iZE7SIzjtq_BcM7iDjtYcsX2_pwA_Sw
INFO:app.features.account.endpoints.auth_jwt:🔹 DBから取得した `user_type`: cast, `affi_type`: None
INFO:app.features.account.endpoints.auth_jwt:✅ 新しい認証トークンを発行: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI0MDYiLCJ1c2VyX2lkIjo0MDYsInVzZXJfdHlwZSI6ImNhc3QiLCJhZmZpX3R5cGUiOm51bGwsImV4cCI6MTc1MjA0NzY5NiwiaWF0IjoxNzUyMDQwNDk2fQ.mQGjq64X7eXPNLBJVmTqRZWudcA_9MupUpAFlwLPgeo
INFO:     172.18.0.1:57106 - "POST /api/v1/account/auth/refresh HTTP/1.1" 200 OK
INFO:     172.18.0.1:57094 - "OPTIONS /api/v1/cast/identity-verification/status HTTP/1.1" 200 OK
INFO:     172.18.0.1:57120 - "OPTIONS /api/v1/posts/cast HTTP/1.1" 200 OK
INFO:     172.18.0.1:57094 - "OPTIONS /api/v1/cast/identity-verification/status HTTP/1.1" 200 OK
[DEBUG] Received cast_id: 406, type: <class 'int'>
[DEBUG] Using cast_id: 406
[ROUTER DEBUG] Returning result: {'cast_id': 406, 'status': 'pending', 'submitted_at': datetime.datetime(2025, 6, 14, 14, 30, 7), 'reviewed_at': None, 'rejection_reason': None, 'bank_name': None, 'branch_name': None, 'branch_code': None, 'account_type': None, 'account_number': None, 'account_holder': None, 'message': '本人確認申請を作成しました。後日結果を確認してください。'}
INFO:     172.18.0.1:57106 - "GET /api/v1/cast/identity-verification/status HTTP/1.1" 200 OK
[DEBUG] Received cast_id: 406, type: <class 'int'>
[DEBUG] Using cast_id: 406
[ROUTER DEBUG] Returning result: {'cast_id': 406, 'status': 'pending', 'submitted_at': datetime.datetime(2025, 6, 14, 14, 30, 7), 'reviewed_at': None, 'rejection_reason': None, 'bank_name': None, 'branch_name': None, 'branch_code': None, 'account_type': None, 'account_number': None, 'account_holder': None, 'message': '本人確認申請を作成しました。後日結果を確認してください。'}
INFO:     172.18.0.1:57134 - "GET /api/v1/cast/identity-verification/status HTTP/1.1" 200 OK
INFO:     172.18.0.1:57124 - "POST /api/v1/posts/cast HTTP/1.1" 200 OK
INFO:     172.18.0.1:56838 - "OPTIONS /api/v1/posts/update HTTP/1.1" 200 OK
INFO:     172.18.0.1:56850 - "POST /api/v1/posts/update HTTP/1.1" 403 Forbidden
INFO:     172.18.0.1:56850 - "POST /api/v1/posts/cast HTTP/1.1" 200 OK
INFO:     172.18.0.1:65186 - "POST /api/v1/posts/update HTTP/1.1" 403 Forbidden
INFO:     172.18.0.1:65186 - "POST /api/v1/posts/cast HTTP/1.1" 200 OK
INFO:     172.18.0.1:55668 - "GET /api/v1/setup/status/setup_status/406 HTTP/1.1" 200 OK
INFO:     172.18.0.1:55668 - "GET /api/v1/setup/status/setup_status/406 HTTP/1.1" 200 OK
INFO:     172.18.0.1:56708 - "OPTIONS /api/v1/referral/get_code HTTP/1.1" 200 OK
INFO:     172.18.0.1:56706 - "OPTIONS /api/v1/referral/invitees HTTP/1.1" 200 OK
[DEBUG] Received cast_id: 406, type: <class 'int'>
[DEBUG] Using cast_id: 406
[ROUTER DEBUG] Returning result: {'cast_id': 406, 'status': 'pending', 'submitted_at': datetime.datetime(2025, 6, 14, 14, 30, 7), 'reviewed_at': None, 'rejection_reason': None, 'bank_name': None, 'branch_name': None, 'branch_code': None, 'account_type': None, 'account_number': None, 'account_holder': None, 'message': '本人確認申請を作成しました。後日結果を確認してください。'}
INFO:     172.18.0.1:56734 - "POST /api/v1/referral/get_code HTTP/1.1" 200 OK
INFO:     172.18.0.1:56696 - "GET /api/v1/cast/identity-verification/status HTTP/1.1" 200 OK
[DEBUG] Received cast_id: 406, type: <class 'int'>
[DEBUG] Using cast_id: 406
[ROUTER DEBUG] Returning result: {'cast_id': 406, 'status': 'pending', 'submitted_at': datetime.datetime(2025, 6, 14, 14, 30, 7), 'reviewed_at': None, 'rejection_reason': None, 'bank_name': None, 'branch_name': None, 'branch_code': None, 'account_type': None, 'account_number': None, 'account_holder': None, 'message': '本人確認申請を作成しました。後日結果を確認してください。'}
INFO:     172.18.0.1:56734 - "GET /api/v1/cast/identity-verification/status HTTP/1.1" 200 OK
INFO:     172.18.0.1:56742 - "GET /api/v1/referral/invitees HTTP/1.1" 200 OK
INFO:app.features.account.endpoints.auth_jwt:🚀 [refresh] トークン更新リクエスト受信
INFO:app.features.account.endpoints.auth_jwt:🔍 受信した refresh_token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI0MDYiLCJ1c2VyX2lkIjo0MDYsImV4cCI6MTc1OTgxNjQ5NiwiaWF0IjoxNzUyMDQwNDk2fQ.weRAX0w4MVH9iZE7SIzjtq_BcM7iDjtYcsX2_pwA_Sw
INFO:app.features.account.endpoints.auth_jwt:🔹 DBから取得した `user_type`: cast, `affi_type`: None
INFO:app.features.account.endpoints.auth_jwt:✅ 新しい認証トークンを発行: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI0MDYiLCJ1c2VyX2lkIjo0MDYsInVzZXJfdHlwZSI6ImNhc3QiLCJhZmZpX3R5cGUiOm51bGwsImV4cCI6MTc1MjA1Mjc2MiwiaWF0IjoxNzUyMDQ1NTYyfQ.TBG-ehIU2SW_opHrjAfFf2K61E84hndDyhBretiOYqw
INFO:     172.18.0.1:61686 - "POST /api/v1/account/auth/refresh HTTP/1.1" 200 OK
INFO:     172.18.0.1:61686 - "GET /api/v1/setup/status/setup_status/406 HTTP/1.1" 200 OK
INFO:     172.18.0.1:63364 - "GET /api/v1/setup/status/setup_status/406 HTTP/1.1" 200 OK
INFO:     172.18.0.1:64976 - "GET /api/v1/setup/status/setup_status/406 HTTP/1.1" 200 OK
