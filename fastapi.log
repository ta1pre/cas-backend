INFO:root:  ‚ûï „Éù„Ç§„É≥„ÉàÂä†ÁÆóÂá¶ÁêÜÈñãÂßã
INFO:root:  üìù ÂèñÂºïÂ±•Ê≠¥‰ΩúÊàêÈñãÂßã
INFO:root:  üíæ „Éá„Éº„Çø„Éô„Éº„Çπ„Å∏„ÅÆ‰øùÂ≠ò (commit) ÈñãÂßã
INFO:root:    üíæ Êõ¥Êñ∞ÊÆãÈ´òÊÉÖÂ†±: {'_sa_instance_state': <sqlalchemy.orm.state.InstanceState object at 0x2aaaf0409430>, 'user_id': 406, 'pending_point_balance': 0, 'last_updated': datetime.datetime(2025, 7, 10, 5, 15, 27, 486789, tzinfo=datetime.timezone.utc), 'regular_point_balance': 62000, 'bonus_point_balance': 80002.0, 'total_point_balance': 142002.0}
INFO:root:    üíæ Êñ∞Ë¶èÂèñÂºïÂ±•Ê≠¥ÊÉÖÂ†±: {'_sa_instance_state': <sqlalchemy.orm.state.InstanceState object at 0x2aaadf376ab0>, 'user_id': 406, 'rule_id': 1, 'transaction_type': 'event_bonus', 'point_change': 1.0, 'point_source': 'bonus', 'balance_after': 142002.0}
INFO:root:  ‚úÖ „Éá„Éº„Çø„Éô„Éº„Çπ„Å∏„ÅÆ‰øùÂ≠òÊàêÂäü (commit ÂÆå‰∫Ü)
INFO:root:üîö apply_point_rule Ê≠£Â∏∏ÁµÇ‰∫Ü
INFO:     172.18.0.1:58648 - "POST /api/v1/points/apply HTTP/1.1" 200 OK
INFO:     172.18.0.1:58648 - "POST /api/v1/points/balance HTTP/1.1" 200 OK
INFO:     172.18.0.1:58648 - "POST /api/v1/points/balance HTTP/1.1" 200 OK
INFO:     172.18.0.1:62728 - "POST /api/v1/admin/test-login/login_nopw HTTP/1.1" 200 OK
INFO:     172.18.0.1:62728 - "POST /api/v1/admin/test-login/login_nopw HTTP/1.1" 404 Not Found
INFO:     172.18.0.1:59774 - "POST /api/v1/admin/test-login/login_nopw HTTP/1.1" 200 OK
INFO:     172.18.0.1:59774 - "POST /api/v1/admin/test-login/login_nopw HTTP/1.1" 200 OK
INFO:     172.18.0.1:59774 - "POST /api/v1/points/balance HTTP/1.1" 200 OK
INFO:     172.18.0.1:59774 - "POST /api/v1/points/balance HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
  + Exception Group Traceback (most recent call last):
  |   File "/usr/local/lib/python3.11/site-packages/starlette/_utils.py", line 87, in collapse_excgroups
  |     yield
  |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 190, in __call__
  |     async with anyio.create_task_group() as task_group:
  |   File "/usr/local/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 401, in run_asgi
    |     result = await app(  # type: ignore[func-returns-value]
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 70, in __call__
    |     return await self.app(scope, receive, send)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1054, in __call__
    |     await super().__call__(scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 123, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 186, in __call__
    |     raise exc
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 189, in __call__
    |     with collapse_excgroups():
    |   File "/usr/local/lib/python3.11/contextlib.py", line 158, in __exit__
    |     self.gen.throw(typ, value, traceback)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/_utils.py", line 93, in collapse_excgroups
    |     raise exc
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/app/app/main.py", line 100, in __call__
    |     return await call_next(request)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 165, in call_next
    |     raise app_exc
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 151, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 65, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 64, in wrapped_app
    |     raise exc
    |   File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 756, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 776, in app
    |     await route.handle(scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 297, in handle
    |     await self.app(scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 77, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 64, in wrapped_app
    |     raise exc
    |   File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 72, in app
    |     response = await func(request)
    |                ^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 278, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 193, in run_endpoint_function
    |     return await run_in_threadpool(dependant.call, **values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/starlette/concurrency.py", line 42, in run_in_threadpool
    |     return await anyio.to_thread.run_sync(func, *args)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/anyio/to_thread.py", line 56, in run_sync
    |     return await get_async_backend().run_sync_in_worker_thread(
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2470, in run_sync_in_worker_thread
    |     return await future
    |            ^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 967, in run
    |     result = context.run(func, *args)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/app/app/features/points/endpoints/points.py", line 15, in get_point_balance
    |     return fetch_point_balance(db, current_user.id)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/app/app/features/points/services/points_service.py", line 24, in fetch_point_balance
    |     return PointBalanceResponse(
    |            ^^^^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/site-packages/pydantic/main.py", line 253, in __init__
    |     validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
    |                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    | pydantic_core._pydantic_core.ValidationError: 1 validation error for PointBalanceResponse
    | pending_points
    |   Field required [type=missing, input_value={'user_id': 407, 'regular...': 0, 'total_points': 0}, input_type=dict]
    |     For further information visit https://errors.pydantic.dev/2.11/v/missing
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 401, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 70, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/applications.py", line 123, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 189, in __call__
    with collapse_excgroups():
  File "/usr/local/lib/python3.11/contextlib.py", line 158, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/usr/local/lib/python3.11/site-packages/starlette/_utils.py", line 93, in collapse_excgroups
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 191, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/app/main.py", line 100, in __call__
    return await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 165, in call_next
    raise app_exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 151, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 65, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 64, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 756, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 776, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 297, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 77, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 64, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 72, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 278, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 193, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/starlette/concurrency.py", line 42, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2470, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 967, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/app/features/points/endpoints/points.py", line 15, in get_point_balance
    return fetch_point_balance(db, current_user.id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/app/features/points/services/points_service.py", line 24, in fetch_point_balance
    return PointBalanceResponse(
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/pydantic/main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_core._pydantic_core.ValidationError: 1 validation error for PointBalanceResponse
pending_points
  Field required [type=missing, input_value={'user_id': 407, 'regular...': 0, 'total_points': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
INFO:root:üöÄ apply_point_rule ÈñãÂßã: user_id=406, rule_name='referral_bonus_referrer_pending', variables={}, transaction_type=None
INFO:root:  ‚úÖ „É´„Éº„É´ÂèñÂæóÊàêÂäü: rule_id=5, point_value=5000.0, is_addition=True
INFO:root:  ‚úÖ „É¶„Éº„Ç∂„Éº 406 „ÅÆ„Éù„Ç§„É≥„ÉàÊÆãÈ´òÂèñÂæó: regular=62000, bonus=80002, total=142002
INFO:root:  ‚öôÔ∏è „Éù„Ç§„É≥„ÉàË®àÁÆóÈñãÂßã: Ë®àÁÆó„Å´‰ΩøÁî®„Åô„ÇãÂÄ§ = 5000.0
INFO:root:  ‚ûï „Éù„Ç§„É≥„ÉàÂä†ÁÆóÂá¶ÁêÜÈñãÂßã
INFO:root:  üìù ÂèñÂºïÂ±•Ê≠¥‰ΩúÊàêÈñãÂßã
INFO:root:  üíæ „Éá„Éº„Çø„Éô„Éº„Çπ„Å∏„ÅÆ‰øùÂ≠ò (commit) ÈñãÂßã
INFO:root:    üíæ Êõ¥Êñ∞ÊÆãÈ´òÊÉÖÂ†±: {'_sa_instance_state': <sqlalchemy.orm.state.InstanceState object at 0x2aaadf376990>, 'user_id': 406, 'pending_point_balance': 0, 'last_updated': datetime.datetime(2025, 7, 10, 5, 15, 53, 746011, tzinfo=datetime.timezone.utc), 'regular_point_balance': 62000, 'bonus_point_balance': 85002.0, 'total_point_balance': 147002.0}
INFO:root:    üíæ Êñ∞Ë¶èÂèñÂºïÂ±•Ê≠¥ÊÉÖÂ†±: {'_sa_instance_state': <sqlalchemy.orm.state.InstanceState object at 0x2aaadf1dd8b0>, 'user_id': 406, 'rule_id': 5, 'transaction_type': 'referral_bonus_pending', 'point_change': 5000.0, 'point_source': 'pending', 'balance_after': 147002.0}
INFO:root:  ‚úÖ „Éá„Éº„Çø„Éô„Éº„Çπ„Å∏„ÅÆ‰øùÂ≠òÊàêÂäü (commit ÂÆå‰∫Ü)
INFO:root:üîö apply_point_rule Ê≠£Â∏∏ÁµÇ‰∫Ü
INFO:     172.18.0.1:59790 - "POST /api/v1/points/apply HTTP/1.1" 200 OK
INFO:root:üöÄ apply_point_rule ÈñãÂßã: user_id=407, rule_name='referral_bonus_referred_pending', variables={}, transaction_type=None
INFO:root:  ‚úÖ „É´„Éº„É´ÂèñÂæóÊàêÂäü: rule_id=6, point_value=2000.0, is_addition=True
INFO:root:  ‚ö†Ô∏è „É¶„Éº„Ç∂„Éº 407 „ÅÆ„Éù„Ç§„É≥„ÉàÊÆãÈ´ò„É¨„Ç≥„Éº„Éâ„ÇíÊñ∞Ë¶è‰ΩúÊàê
INFO:root:  ‚öôÔ∏è „Éù„Ç§„É≥„ÉàË®àÁÆóÈñãÂßã: Ë®àÁÆó„Å´‰ΩøÁî®„Åô„ÇãÂÄ§ = 2000.0
INFO:root:  ‚ûï „Éù„Ç§„É≥„ÉàÂä†ÁÆóÂá¶ÁêÜÈñãÂßã
INFO:root:  üìù ÂèñÂºïÂ±•Ê≠¥‰ΩúÊàêÈñãÂßã
INFO:root:  üíæ „Éá„Éº„Çø„Éô„Éº„Çπ„Å∏„ÅÆ‰øùÂ≠ò (commit) ÈñãÂßã
INFO:root:    üíæ Êñ∞Ë¶èÊÆãÈ´òÊÉÖÂ†±: {'_sa_instance_state': <sqlalchemy.orm.state.InstanceState object at 0x2aaadf1dde50>, 'user_id': 407, 'regular_point_balance': 0, 'bonus_point_balance': 2000.0, 'total_point_balance': 2000.0, 'last_updated': datetime.datetime(2025, 7, 10, 5, 15, 53, 949589, tzinfo=datetime.timezone.utc)}
INFO:root:    üíæ Êñ∞Ë¶èÂèñÂºïÂ±•Ê≠¥ÊÉÖÂ†±: {'_sa_instance_state': <sqlalchemy.orm.state.InstanceState object at 0x2aaadf375d30>, 'user_id': 407, 'rule_id': 6, 'transaction_type': 'referral_bonus_pending', 'point_change': 2000.0, 'point_source': 'pending', 'balance_after': 2000.0}
INFO:root:  ‚úÖ „Éá„Éº„Çø„Éô„Éº„Çπ„Å∏„ÅÆ‰øùÂ≠òÊàêÂäü (commit ÂÆå‰∫Ü)
INFO:root:üîö apply_point_rule Ê≠£Â∏∏ÁµÇ‰∫Ü
INFO:     172.18.0.1:59790 - "POST /api/v1/points/apply HTTP/1.1" 200 OK
INFO:     172.18.0.1:59790 - "POST /api/v1/points/balance HTTP/1.1" 200 OK
INFO:     172.18.0.1:59790 - "POST /api/v1/points/balance HTTP/1.1" 200 OK
INFO:     172.18.0.1:59152 - "POST /api/v1/admin/test-login/login_nopw HTTP/1.1" 200 OK
INFO:     172.18.0.1:59152 - "POST /api/v1/points/balance HTTP/1.1" 200 OK
INFO:     172.18.0.1:59152 - "POST /api/v1/points/apply HTTP/1.1" 422 Unprocessable Entity
INFO:     172.18.0.1:59152 - "POST /api/v1/points/balance HTTP/1.1" 200 OK
INFO:root:üöÄ apply_point_rule ÈñãÂßã: user_id=406, rule_name='reservation_payment', variables={'reservation_id': 999, 'amount': 5000}, transaction_type=None
INFO:root:  ‚úÖ „É´„Éº„É´ÂèñÂæóÊàêÂäü: rule_id=3, point_value=0.0, is_addition=True
INFO:root:  ‚úÖ „É¶„Éº„Ç∂„Éº 406 „ÅÆ„Éù„Ç§„É≥„ÉàÊÆãÈ´òÂèñÂæó: regular=62000, bonus=85002, total=147002
INFO:root:  ‚û°Ô∏è Â§âÊï∞„Åã„Çâ„Éù„Ç§„É≥„ÉàÂÄ§„ÇíÂèñÂæó: 5000
INFO:root:  ‚öôÔ∏è „Éù„Ç§„É≥„ÉàË®àÁÆóÈñãÂßã: Ë®àÁÆó„Å´‰ΩøÁî®„Åô„ÇãÂÄ§ = 5000
INFO:root:  ‚ûï „Éù„Ç§„É≥„ÉàÂä†ÁÆóÂá¶ÁêÜÈñãÂßã
INFO:root:  üìù ÂèñÂºïÂ±•Ê≠¥‰ΩúÊàêÈñãÂßã
INFO:root:    ‚ö†Ô∏è transaction_type „Çí 'deposit' „Å´Ë®≠ÂÆö
INFO:root:    üìù ÂèñÂºïÂ±•Ê≠¥„Å´‰∫àÁ¥ÑID 999 „ÇíÈñ¢ÈÄ£‰ªò„Åë
INFO:root:  üíæ „Éá„Éº„Çø„Éô„Éº„Çπ„Å∏„ÅÆ‰øùÂ≠ò (commit) ÈñãÂßã
INFO:root:    üíæ Êõ¥Êñ∞ÊÆãÈ´òÊÉÖÂ†±: {'_sa_instance_state': <sqlalchemy.orm.state.InstanceState object at 0x2aaaf04087d0>, 'user_id': 406, 'pending_point_balance': 0, 'last_updated': datetime.datetime(2025, 7, 10, 5, 25, 27, 204210, tzinfo=datetime.timezone.utc), 'regular_point_balance': 67000, 'bonus_point_balance': 85002, 'total_point_balance': 152002}
INFO:root:    üíæ Êñ∞Ë¶èÂèñÂºïÂ±•Ê≠¥ÊÉÖÂ†±: {'_sa_instance_state': <sqlalchemy.orm.state.InstanceState object at 0x2aaadf1df110>, 'user_id': 406, 'rule_id': 3, 'transaction_type': 'deposit', 'point_change': 5000, 'point_source': 'regular', 'balance_after': 152002, 'related_id': 999, 'related_table': 'reservation'}
INFO:root:  ‚úÖ „Éá„Éº„Çø„Éô„Éº„Çπ„Å∏„ÅÆ‰øùÂ≠òÊàêÂäü (commit ÂÆå‰∫Ü)
INFO:root:üîö apply_point_rule Ê≠£Â∏∏ÁµÇ‰∫Ü
INFO:     172.18.0.1:59152 - "POST /api/v1/points/apply HTTP/1.1" 200 OK
INFO:     172.18.0.1:59152 - "POST /api/v1/points/balance HTTP/1.1" 200 OK
INFO:     172.18.0.1:59152 - "POST /api/v1/points/history HTTP/1.1" 200 OK
INFO:     172.18.0.1:59152 - "POST /api/v1/points/balance HTTP/1.1" 200 OK
INFO:root:üöÄ apply_point_rule ÈñãÂßã: user_id=406, rule_name='referral_bonus_referrer_confirmed', variables={'reservation_id': 999, 'referred_user_id': 407}, transaction_type=None
INFO:root:  ‚úÖ „É´„Éº„É´ÂèñÂæóÊàêÂäü: rule_id=7, point_value=5000.0, is_addition=True
INFO:root:  ‚úÖ „É¶„Éº„Ç∂„Éº 406 „ÅÆ„Éù„Ç§„É≥„ÉàÊÆãÈ´òÂèñÂæó: regular=67000, bonus=85002, total=152002
INFO:root:  ‚öôÔ∏è „Éù„Ç§„É≥„ÉàË®àÁÆóÈñãÂßã: Ë®àÁÆó„Å´‰ΩøÁî®„Åô„ÇãÂÄ§ = 5000.0
INFO:root:  ‚ûï „Éù„Ç§„É≥„ÉàÂä†ÁÆóÂá¶ÁêÜÈñãÂßã
INFO:root:  üìù ÂèñÂºïÂ±•Ê≠¥‰ΩúÊàêÈñãÂßã
INFO:root:    üìù ÂèñÂºïÂ±•Ê≠¥„Å´‰∫àÁ¥ÑID 999 „ÇíÈñ¢ÈÄ£‰ªò„Åë
INFO:root:  üíæ „Éá„Éº„Çø„Éô„Éº„Çπ„Å∏„ÅÆ‰øùÂ≠ò (commit) ÈñãÂßã
INFO:root:    üíæ Êõ¥Êñ∞ÊÆãÈ´òÊÉÖÂ†±: {'_sa_instance_state': <sqlalchemy.orm.state.InstanceState object at 0x2aaadf14da30>, 'user_id': 406, 'pending_point_balance': 0, 'last_updated': datetime.datetime(2025, 7, 10, 5, 25, 29, 731068, tzinfo=datetime.timezone.utc), 'regular_point_balance': 67000, 'bonus_point_balance': 90002.0, 'total_point_balance': 157002.0}
INFO:root:    üíæ Êñ∞Ë¶èÂèñÂºïÂ±•Ê≠¥ÊÉÖÂ†±: {'_sa_instance_state': <sqlalchemy.orm.state.InstanceState object at 0x2aaadf2d1010>, 'user_id': 406, 'rule_id': 7, 'transaction_type': 'referral_bonus_completed', 'point_change': 5000.0, 'point_source': 'bonus', 'balance_after': 157002.0, 'related_id': 999, 'related_table': 'reservation'}
INFO:root:  ‚úÖ „Éá„Éº„Çø„Éô„Éº„Çπ„Å∏„ÅÆ‰øùÂ≠òÊàêÂäü (commit ÂÆå‰∫Ü)
INFO:root:üîö apply_point_rule Ê≠£Â∏∏ÁµÇ‰∫Ü
INFO:     172.18.0.1:59152 - "POST /api/v1/points/apply HTTP/1.1" 200 OK
INFO:     172.18.0.1:59152 - "POST /api/v1/points/balance HTTP/1.1" 200 OK
INFO:     172.18.0.1:59152 - "POST /api/v1/points/history HTTP/1.1" 200 OK
INFO:     172.18.0.1:59152 - "POST /api/v1/points/balance HTTP/1.1" 200 OK
INFO:     172.18.0.1:59152 - "POST /api/v1/points/purchase HTTP/1.1" 200 OK
INFO:     172.18.0.1:59152 - "POST /api/v1/points/balance HTTP/1.1" 200 OK
INFO:     172.18.0.1:59152 - "POST /api/v1/points/history HTTP/1.1" 200 OK
INFO:     172.18.0.1:59152 - "POST /api/v1/points/balance HTTP/1.1" 200 OK
INFO:app.features.account.endpoints.auth_jwt:üöÄ [refresh] „Éà„Éº„ÇØ„É≥Êõ¥Êñ∞„É™„ÇØ„Ç®„Çπ„ÉàÂèó‰ø°
INFO:app.features.account.endpoints.auth_jwt:üîç Âèó‰ø°„Åó„Åü refresh_token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI0MDYiLCJ1c2VyX2lkIjo0MDYsImV4cCI6MTc1OTg5ODA3NywiaWF0IjoxNzUyMTIyMDc3fQ.I9WxCY_Sv1p9-t3bleVcBPtFZ3_dWofBYp_7nHlCf4Y
ERROR:app.features.account.endpoints.auth_jwt:‚õî „É™„Éï„É¨„ÉÉ„Ç∑„É•„Éà„Éº„ÇØ„É≥„ÅÆÊ§úË®º„Ç®„É©„Éº: (pymysql.err.OperationalError) (2013, 'Lost connection to MySQL server during query')
[SQL: SELECT users.id AS users_id, users.nick_name AS users_nick_name, users.prefectures AS users_prefectures, users.station AS users_station, users.line_id AS users_line_id, users.invitation_id AS users_invitation_id, users.tracking_id AS users_tracking_id, users.email AS users_email, users.email_verified AS users_email_verified, users.mobile_phone AS users_mobile_phone, users.phone_verification_code AS users_phone_verification_code, users.phone_verified AS users_phone_verified, users.picture_url AS users_picture_url, users.password_hash AS users_password_hash, users.sex AS users_sex, users.birth AS users_birth, users.user_type AS users_user_type, users.affi_type AS users_affi_type, users.last_login AS users_last_login, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.setup_status AS users_setup_status, users.stripe_customer_id AS users_stripe_customer_id 
FROM users 
WHERE users.id = %(id_1)s 
 LIMIT %(param_1)s]
[parameters: {'id_1': 406, 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     172.18.0.1:61618 - "POST /api/v1/account/auth/refresh HTTP/1.1" 401 Unauthorized
INFO:app.features.account.endpoints.auth_jwt:üöÄ [refresh] „Éà„Éº„ÇØ„É≥Êõ¥Êñ∞„É™„ÇØ„Ç®„Çπ„ÉàÂèó‰ø°
INFO:app.features.account.endpoints.auth_jwt:üîç Âèó‰ø°„Åó„Åü refresh_token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI0MDYiLCJ1c2VyX2lkIjo0MDYsImV4cCI6MTc1OTg5ODA3NywiaWF0IjoxNzUyMTIyMDc3fQ.I9WxCY_Sv1p9-t3bleVcBPtFZ3_dWofBYp_7nHlCf4Y
INFO:app.features.account.endpoints.auth_jwt:üîπ DB„Åã„ÇâÂèñÂæó„Åó„Åü `user_type`: cast, `affi_type`: None
INFO:app.features.account.endpoints.auth_jwt:‚úÖ Êñ∞„Åó„ÅÑË™çË®º„Éà„Éº„ÇØ„É≥„ÇíÁô∫Ë°å: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI0MDYiLCJ1c2VyX2lkIjo0MDYsInVzZXJfdHlwZSI6ImNhc3QiLCJhZmZpX3R5cGUiOm51bGwsImV4cCI6MTc1MjQ3MjE3OCwiaWF0IjoxNzUyNDY0OTc4fQ.wdza_IJdLM06yQE38AUSVU820qoqX1hhI_84ZeLl4CE
INFO:     172.18.0.1:57932 - "POST /api/v1/account/auth/refresh HTTP/1.1" 200 OK
INFO:     172.18.0.1:57932 - "GET /api/v1/setup/status/setup_status/406 HTTP/1.1" 200 OK
INFO:     172.18.0.1:57940 - "OPTIONS /api/v1/account/auth/extend_refresh_token HTTP/1.1" 200 OK
üöÄ „Äêextend_refresh_token„Äë „É™„ÇØ„Ç®„Çπ„Éà„Çí‰ªä„Åã„ÇâÂèó‰ø°
üöÄ „Äêextend_refresh_token„Äë „É™„ÇØ„Ç®„Çπ„ÉàÂèó‰ø° - refresh_token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI0MDYiLCJ1c2VyX2lkIjo0MDYsImV4cCI6MTc1OTg5ODA3NywiaWF0IjoxNzUyMTIyMDc3fQ.I9WxCY_Sv1p9-t3bleVcBPtFZ3_dWofBYp_7nHlCf4Y
üïí „Äêextend_refresh_token„Äë ÁèæÂú®ÊôÇÂàª: 1752464979 / refresh_token ÊúâÂäπÊúüÈôê: 1759898077 / ÊÆã„Çä 7433098 Áßí
üîÑ „Äêextend_refresh_token„Äë `refresh_token` „ÅÆÊúüÈôê„ÅåËøë„ÅÑ„Åü„ÇÅÊõ¥Êñ∞: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI0MDYiLCJ1c2VyX2lkIjo0MDYsImV4cCI6MTc2MDI0MDk3OSwiaWF0IjoxNzUyNDY0OTc5fQ.b_lymp44ch0Z2Zm8yyXOjO76lX8-Bjpl2_i7xsCd9wY
INFO:     172.18.0.1:57944 - "POST /api/v1/account/auth/extend_refresh_token HTTP/1.1" 200 OK
INFO:     172.18.0.1:57940 - "OPTIONS /api/v1/account/auth/refresh HTTP/1.1" 200 OK
INFO:app.features.account.endpoints.auth_jwt:üöÄ [refresh] „Éà„Éº„ÇØ„É≥Êõ¥Êñ∞„É™„ÇØ„Ç®„Çπ„ÉàÂèó‰ø°
INFO:app.features.account.endpoints.auth_jwt:üîç Âèó‰ø°„Åó„Åü refresh_token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI0MDYiLCJ1c2VyX2lkIjo0MDYsImV4cCI6MTc2MDI0MDk3OSwiaWF0IjoxNzUyNDY0OTc5fQ.b_lymp44ch0Z2Zm8yyXOjO76lX8-Bjpl2_i7xsCd9wY
INFO:app.features.account.endpoints.auth_jwt:üîπ DB„Åã„ÇâÂèñÂæó„Åó„Åü `user_type`: cast, `affi_type`: None
INFO:app.features.account.endpoints.auth_jwt:‚úÖ Êñ∞„Åó„ÅÑË™çË®º„Éà„Éº„ÇØ„É≥„ÇíÁô∫Ë°å: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI0MDYiLCJ1c2VyX2lkIjo0MDYsInVzZXJfdHlwZSI6ImNhc3QiLCJhZmZpX3R5cGUiOm51bGwsImV4cCI6MTc1MjQ3MjE3OSwiaWF0IjoxNzUyNDY0OTc5fQ.bDdpoYAk9UGp50vOpr-WFUApCRlFb6Tstjywt3VgDNo
INFO:     172.18.0.1:57944 - "POST /api/v1/account/auth/refresh HTTP/1.1" 200 OK
INFO:     172.18.0.1:57940 - "OPTIONS /api/v1/points/admin/rules HTTP/1.1" 200 OK
INFO:app.features.points.endpoints.admin_points:üîç [admin] „Éù„Ç§„É≥„Éà„É´„Éº„É´‰∏ÄË¶ßÂèñÂæóÈñãÂßã
INFO:app.features.points.endpoints.admin_points:‚úÖ [admin] „Éù„Ç§„É≥„Éà„É´„Éº„É´‰∏ÄË¶ßÂèñÂæóÊàêÂäü: 8‰ª∂
INFO:     172.18.0.1:57944 - "GET /api/v1/points/admin/rules HTTP/1.1" 200 OK
